<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>Title</title>
<base href="/hm/">
<link rel="stylesheet" href="lib/layui/css/layui.css" />
<script src="lib/jquery-3.5.1.js"></script>
<script src="lib/layui/layui.js"></script>
</head>
<body>

    <div class="demoTable layui-form layui-form-pane">

        <div class="layui-form-item layui-input-inline">
            <div class="layui-inline">
                <label class="layui-form-label">学科</label>
                <div class="layui-input-inline">
                    <select id="selectCourse" name="course" lay-verify="required">
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item layui-input-inline">
            <div class="layui-inline">
                <label class="layui-form-label">标题</label>
                <div class="layui-input-inline">
                    <input class="layui-input" name="title" id="title">
                </div>
            </div>
        </div>

        <div class="layui-form-item layui-input-inline">
            <div class="layui-inline">
                <button class="layui-btn" data-type="reload">搜索</button>
            </div>
        </div>
    </div>

    <table id="homeworkPage" lay-filter="homeworkPage"></table>

</body>
</html>
<script src="lib/layui/layui.js"></script>
<script type="text/html" id="bar">
    <a class="layui-btn layui-btn-primary layui-btn-xs" lay-event="detail">查看</a>
    <a class="layui-btn layui-btn-xs" lay-event="edit">编辑</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>
<script>
    $.ajax({
        url:'homework/getCourseList.do',
        type:'get',
        dataType:'json',
        async:false,
        success:function (data){
            let html = '<option value="0">全部</option>';
            $.each(data,function (i,n) {
                html += '<option value="'+n.id+'">'+n.name+'</option>'
            })
            $('#selectCourse').html(html);
        }
    })
</script>
<script>
    layui.use('table', function(){
        var table = layui.table;

        //表格渲染
        table.render({
            id:'homeworkPage'
            ,elem: '#homeworkPage'
            // ,cellMinWidth: 'auto'
            // ,cellWidth: 'auto'
            ,url: 'page.json' //数据接口
            ,page: true //开启分页
            ,cols: [[ //表头
                {type: 'checkbox'}
                ,{field: 'id', title: 'ID',sort: true}
                ,{field: 'title', title: '标题'}
                ,{field: 'course', title: '学科',sort: true}
                ,{field: 'lastCommitDate', title: '最后提交时间',sort: true}
                ,{field: 'createDate', title: '创建时间',sort: true}
                ,{field: 'briefInfo', title: '简略信息'}
                ,{field: 'detailInfo', title: '详细信息'}
                ,{toolbar: '#bar',title: '操作'}
            ]]
        });

        //监听工具条（右侧 查看、编辑、删除）
        table.on('tool(homeworkPage)', function(obj){
            var data = obj.data;
            if(obj.event === 'detail'){
                layer.msg('ID：'+ data.id + ' 的查看操作');
            } else if(obj.event === 'del'){
                layer.confirm('确认要删除么？', function(index){
                    window.parent.cocoMessage.loading("删除中...");
                    $.ajax({
                        url:'homework/deleteHomework.do',
                        data:{hid:data.id},
                        type:'post',
                        dataType:'json',
                        success:function (data) {
                            window.parent.cocoMessage.destroyAll();
                            if (data.success) {
                                obj.del();
                                layer.close(index);
                                window.parent.cocoMessage.success(2000, "删除成功")
                            } else {
                                window.parent.cocoMessage.error(2000, "删除失败")
                            }
                        },error:function () {
                            window.parent.cocoMessage.destroyAll();
                            window.parent.cocoMessage.error(2000, "删除失败")
                        }
                    })
                    // url: homework/deleteHomework.do
                });
            } else if(obj.event === 'edit'){
                layer.alert('编辑行：<br>'+ JSON.stringify(data))
            }
        });



        //搜索条件
        active = {
            reload: function(){
                let selectCourse = $('#selectCourse');
                let title = $('#title');

                //执行重载
                table.reload('homeworkPage', {
                    page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    ,where: {
                        course: selectCourse.val(),
                        title: title.val(),
                    }
                }, 'data');
            }
        };

        $('.demoTable .layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });
</script>
